# CloudKitty Loki Deployment with Red Hat Loki Operator

1. Create the internal certificate
```
$ oc apply -f certificate-internal.yaml
$ oc apply -f certificate-public.yaml
```

2. Create ConfigMap
```
$ kubectl create configmap lokistack-mtls --from-literal=ca.crt="$(kubectl get secret cert-loki-public-route -n openstack -o jsonpath='{.data.ca\.crt}' | base64 -d)" -n openstack
```

# Need to set up S3
oc apply -f <telemetry_operator_repo>/ci/deploy-logging-dependencies/files/minio-dev.yaml

oc apply -f loki-subscription.yaml

3. Edit loki-secret.yaml with the appropiate data to connect to S3:
```
  access_key_id: <your access key id>
  access_key_secret: <your access key secret>
  bucketnames: <your S3 bucket name>
  endpoint: <your S3 endpoint url>
```

4. Create LokiStack:
```
$ oc apply -f lokistack.yaml
```

5. Check that Loki pods have been created in the openstack namespace:
```
lokistack-compactor-0                                         1/1     Running     0          18m
lokistack-distributor-65c994c58-c84rw                         1/1     Running     0          18m
lokistack-gateway-6dbbc4d789-lnjdv                            1/1     Running     0          18m
lokistack-gateway-6dbbc4d789-s8pwx                            1/1     Running     0          18m
lokistack-index-gateway-0                                     1/1     Running     0          18m
lokistack-ingester-0                                          1/1     Running     0          18m
lokistack-querier-7f887c4f89-rw7qb                            1/1     Running     0          18m
lokistack-query-frontend-57576979bf-qbxw7                     1/1     Running     0          18m
```
